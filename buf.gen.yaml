version: v2

inputs:
  - directory: proto

plugins:
  # 1. Go Structs
  - remote: buf.build/protocolbuffers/go
    out: server/gen
    opt: paths=source_relative

  # 2. Go gRPC Communication Code
  - remote: buf.build/grpc/go
    out: server/gen
    opt: paths=source_relative

  # 3. OpenAPI (Swagger) JSON
  # Frontend (SPA) API Definition
  # Merge multiple proto files into a single "api.swagger.json"
  - remote: buf.build/grpc-ecosystem/openapiv2
    out: web/packages/api/openapi
    opt:
      - json_names_for_fields=false
      - allow_merge=true
      - merge_file_name=api