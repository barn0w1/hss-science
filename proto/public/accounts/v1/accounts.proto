syntax = "proto3";

package hss_science.accounts.v1;

option go_package = "github.com/barn0w1/hss-science/server/gen/public/accounts/v1;accountsv1";

import "google/api/annotations.proto";

service AccountsService {
  // GET /v1/auth/login-url?redirect_to=...
  rpc GetLoginUrl(GetLoginUrlRequest) returns (GetLoginUrlResponse) {
    option (google.api.http) = {
      get: "/v1/auth/login-url"
    };
  }

  // POST /v1/auth/callback
  // Body: { "code": "...", "state": "..." }
  rpc OAuthCallback(OAuthCallbackRequest) returns (OAuthCallbackResponse) {
    option (google.api.http) = {
      post: "/v1/auth/callback"
      body: "*"
    };
  }

  // POST /v1/auth/logout
  rpc Logout(LogoutRequest) returns (LogoutResponse) {
    option (google.api.http) = {
      post: "/v1/auth/logout"
    };
  }

  // POST /v1/auth/refresh
  rpc Refresh(RefreshRequest) returns (RefreshResponse) {
    option (google.api.http) = {
      post: "/v1/auth/refresh"
    };
  }

  // GET /v1/auth/session
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse) {
    option (google.api.http) = {
      get: "/v1/auth/session"
    };
  }
}

// ===== Requests / Responses =====

message GetLoginUrlRequest {
  string redirect_to = 1;
}

message GetLoginUrlResponse {
  string url = 1;
}

message OAuthCallbackRequest {
  string code = 1;
  string state = 2;
}

message OAuthCallbackResponse {
  Session session = 1;
}

message LogoutRequest {}
message LogoutResponse {}

message RefreshRequest {}
message RefreshResponse {
  Session session = 1;
}

message GetSessionRequest {}
message GetSessionResponse {
  Session session = 1;
}

// ===== Data Models =====

message Session {
  string user_id = 1;
  string display_name = 2;
  string avatar_url = 3;
}